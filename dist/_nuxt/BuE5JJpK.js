import{_ as R}from"./CaDaOOkr.js";import{u as F,n as K,m as L,r as i,q as O,s as P,A as J,c,a as t,v as n,t as l,x as k,b as S,w as D,B as Q,C as G,I as w,N as T,D as W,H as X,Q as Y,L as Z,y as z,T as ee,o as d,d as A}from"./BDtLa2_E.js";const te=window.setInterval,se={class:"container container-note"},ae={key:0,class:"table-box position-relative"},oe={class:"d-flex align-items-center gap-4 mb-4"},ne={class:"title"},le={class:"title"},re={class:"d-flex align-items-center justify-content-between gap-3 mb-4"},ie={class:""},ce={class:"msg-name"},de={class:"fs-xs"},ue={class:"flex-fill"},_e={class:"content"},me={class:"time"},ge={class:"msg_height_box"},fe=["disabled"],ve={key:0},he={key:1,class:"loader loader--style2",title:"1"},we={version:"1.1",id:"loader-1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"40px",height:"40px",viewBox:"0 0 50 50",style:{"enable-background":"new 0 0 50 50"},"xml:space":"preserve"},ye={__name:"note",setup(pe){const o=F(),U=K();L();const u=U.query.id,v=i({}),_=i(),g=i(!1),f=i(""),m=i(""),B=i(!1),p=i(!0),h=i(!1),V=s=>s==f.value?"my_msg":null,x=()=>{$(".msg-box").animate({scrollTop:$(".msg-box")[0].scrollHeight},500),g.value=!1},H=()=>{const s=$(".msg-box")[0],e=s.scrollTop+s.clientHeight>=s.scrollHeight-300;B.value=!e,e&&(g.value=!1)},q=(s,e)=>{if(e==f.value)return"bg-my_roles";switch(s){case"manager":return"bg-manager";case"dealer":return"bg-dealer";case"salesperson":return"bg-member"}},C=async()=>{h.value=!0;const s=`${o.baseUrl}api/v2/sales/orders/comments/add?locale=${o.language}`,e={order_id:u,comment:m.value};try{(await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o.userData.jwtToken},body:JSON.stringify(e)})).json()).success&&(m.value="",j())}catch(r){console.log("error",r)}await b(),x(),h.value=!1},b=async()=>{const s=`${o.baseUrl}api/v2/sales/orders/comments/list?locale=${o.language}&limit=0&equal_order_id=${u}&limit=0&pagination=false`;try{const e=await fetch(s,{headers:{Authorization:"Bearer "+o.userData.jwtToken}}),r=await e.json();if(e.ok){const a=r.response.data.sort((y,E)=>y.id-E.id);if(_.value){const y=a[a.length-1].user_id==f.value;a.length>_.value.length&&(_.value=a,y||(g.value=!0))}else{_.value=a;return}}}catch(e){console.log("error",e)}},I=async()=>{const s=await o.get_user_data();f.value=s.user_id,console.log(f.value)},M=async()=>{const s=`${o.baseUrl}api/v2/sales/orders/info?locale=${o.language}&equal_id=${u}`;try{const e=await fetch(s,{headers:{Authorization:"Bearer "+o.userData.jwtToken}}),r=await e.json();e.ok&&(v.value=r.response)}catch(e){console.log("error",e)}},j=async()=>{const s=`${o.baseUrl}api/v2/sales/orders/comments/clearCommentCount?order_id=${u}`;try{const r=await(await fetch(s,{headers:{Authorization:"Bearer "+o.userData.jwtToken}})).json()}catch{console.log("error")}};let N;return o.show_loading(!0),O(async()=>{if(u){j(),await M();try{await Promise.all([b(),I()]),o.show_loading(!1),P(()=>{const s=$(".msg-box");s.length&&s.scrollTop(s[0].scrollHeight)})}catch(s){console.error("Error:",s)}}N=te(async()=>{b()},5e3)}),J(()=>{clearInterval(N)}),(s,e)=>{const r=R;return d(),c("section",{class:"bg-block",onClick:e[2]||(e[2]=a=>g.value=!1)},[t("div",se,[n(o).loading?z("",!0):(d(),c("div",ae,[t("div",oe,[t("h2",ne,l(n(v).code),1),t("div",{class:k(["tag m-0",n(o).status_colors(n(v).status_code)])},l(n(v).status_name),3),t("h2",le,l(n(o).language_txt.default.tab_comments),1)]),t("div",re,[S(r,{to:`/order-list/item?id=${n(u)}`,class:"btn link"},{default:D(()=>{var a;return[A(l((a=n(o).language_txt.default)==null?void 0:a.text_back),1)]}),_:1},8,["to"])]),t("div",ie,[!n(o).loading&&n(_)?(d(),c("div",{key:0,class:"msg-box",onScroll:H},[(d(!0),c(Q,null,G(n(_),a=>(d(),c("div",{class:k(["msg-inner",V(a.user_id)]),key:a.id},[t("div",ce,[t("div",null,[t("i",{class:k(["fas fa-circle",q(a.identity,a.user_id)])},null,2)]),t("div",null,[t("p",de,l(a.identity_name),1),t("p",null,l(a.commenter_name),1)])]),t("div",ue,[t("div",_e,l(a.comment),1),t("span",me,l(a.created_at),1)])],2))),128)),w(t("form",{class:"for_msg",onSubmit:W(C,["prevent"])},[t("div",ge,l(n(m)),1),w(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=a=>X(m)?m.value=a:null),onKeyup:Y(C,["enter"])},null,544),[[Z,n(m)]]),t("button",{type:"submit",class:"btn sent_go",disabled:n(h)},[n(h)?(d(),c("div",he,[(d(),c("svg",we,e[3]||(e[3]=[t("path",{fill:"#F6930E",d:"M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"},[t("animateTransform",{attributeType:"xml",attributeName:"transform",type:"rotate",from:"0 25 25",to:"360 25 25",dur:"0.6s",repeatCount:"indefinite"})],-1)])))])):(d(),c("span",ve,l(n(o).language_txt.default.text_send),1))],8,fe)],544),[[T,n(p)]])],32)):z("",!0)]),w(t("div",{class:"to_bottom",onClick:x},e[4]||(e[4]=[t("i",{class:"fas fa-arrow-down"},null,-1)]),512),[[T,n(B)]]),t("div",{class:"show_textarea",onClick:e[1]||(e[1]=a=>p.value=!n(p))},e[5]||(e[5]=[t("i",{class:"fas fa-comment"},null,-1)])),S(ee,{name:"slide",duration:550},{default:D(()=>[w(t("div",{class:"new_msg alart_box",onClick:x},[e[6]||(e[6]=t("i",{class:"fas fa-comment-dots"},null,-1)),A(" "+l(n(o).language_txt.default.text_you_have_new_message),1)],512),[[T,n(g)]])]),_:1})]))])])}}};export{ye as default};
