import{_ as F}from"./CaDaOOkr.js";import{u as de,n as ue,m as ie,r as j,p as C,g as ce,q as _e,c as g,a as s,v as t,t as l,x as I,b as S,w as y,G as z,y as b,I as N,J as R,H as E,P as pe,B as L,C as G,N as me,o as p,d as w}from"./BDtLa2_E.js";const ge={class:"bg-block"},fe={class:"container"},he={key:0,class:"table-box"},ve={class:"d-flex align-items-center justify-content-between flex-wrap mb-4 gap-4"},be={class:"d-flex align-items-center gap-4"},xe={class:"title"},ye={class:"tag tag-material tag-blue"},we={class:"total-data"},ke={class:"fw-bold"},$e={class:"fw-bold"},Ce={class:"fw-bold"},je={class:"d-flex align-items-center gap-3 mb-4"},qe={class:"table-inner"},Te={class:"table"},De={class:"pe-5 col-2"},Se={value:"10",selected:""},Oe={value:"30"},Be={value:"50"},Ne=["onUpdate:modelValue"],Ue={key:0,class:"col-2"},Pe=["onClick"],Ae=["onClick"],Ve={key:1,class:"col-2"},ze=["onClick"],Je=["onClick"],Me=["disabled"],Fe={key:0,class:"pages"},Ie=["disabled"],Re=["onClick"],Ee=["disabled"],Le={class:"d-flex align-items-center justify-content-center gap-4 mt-5"},Qe={__name:"index",setup(Ge){const e=de(),H=ue(),K=ie(),m=j([]),n=j(),q=j(!1),v=j([]),f=H.query.id,x=j(1),k=j(10),U=d=>{var o;return(o=e.language_txt.default)==null?void 0:o.text_row_limit.replace(":number",d)},$=C(()=>n.value.status_code=="Draft"),T=C(()=>n.value.status_code=="Pending"),Q=C(()=>v.value.some(d=>d==!0));ce(()=>v.value,(d,o)=>{d.find(u=>u===!0)||(q.value=!1)},{deep:!0});const W=()=>{q.value?v.value=v.value.map(()=>!0):v.value=v.value.map(()=>!1)},X=d=>{var u;const o=(u=d.order_product_options[n.value.material+"_win_frame"])==null?void 0:u.value;return o||"N/A"},Y=C(()=>m.value.reduce((d,o)=>(d+=+o.quantity,d),0)),Z=C(()=>m.value.reduce((d,o)=>(d+=+o.sqm,d),0)),J=C(()=>Math.ceil(m.value.length/+k.value)),P=d=>{switch(!0){case d==-1:x.value--;break;case d==-2:x.value++;break;default:x.value=d;break}//! 拉至視窗上
document.querySelector(".table").scrollIntoView({behavior:"smooth"})},ee=d=>x.value==d?"pages-active":null,te=C(()=>{const d=(x.value-1)*k.value,o=x.value*k.value;return m.value.slice(d,o)}),M=async d=>{var u;if(confirm((u=e.language_txt.order)==null?void 0:u.text_confirm_copy)){e.show_loading(!0);const r=JSON.parse(JSON.stringify(d));delete r.created_at,delete r.updated_at,delete r.sort_order,delete r.id,Object.keys(r.order_product_options).forEach(a=>{delete r.order_product_options[a].id,delete r.order_product_options[a].order_product_id,delete r.order_product_options[a].sort_order,delete r.order_product_options[a].created_at,delete r.order_product_options[a].updated_at,(r.order_product_options[a].type=="checkbox"||r.order_product_options[a].type=="images")&&Object.values(r.order_product_options[a].option_values).map(i=>{delete i.id,delete i.sort_order})}),await V(r),console.log(r),e.show_loading(!1)}},A=async d=>{var u;confirm((u=e.language_txt.order)==null?void 0:u.text_confirm_delete)&&$.value&&(e.show_loading(!0),d!==void 0?m.value.splice(d,1):m.value.reduce((a,i,h)=>(v.value[h]&&a.push(i.id),a),[]).map(a=>{const i=m.value.findIndex(h=>h.id===a);i!==-1&&m.value.splice(i,1)}),await V("delete"),e.show_loading(!1))},ae=async()=>{var o;if(confirm((o=e.language_txt.order)==null?void 0:o.text_confirm_submit)){e.show_loading(!0);const u=`${e.baseUrl}api/v2/sales/orders/apply?locale=${e.language}`,r={order_id:f};try{const a=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.userData.jwtToken},body:JSON.stringify(r)}),i=await a.json();a.ok&&alert(i.success)}catch(a){console.log("error",a)}await D(),e.show_loading(!1)}},oe=async()=>{var o;if(confirm((o=e.language_txt.order)==null?void 0:o.text_confirm_return)){e.show_loading(!0);const u=`${e.baseUrl}api/v2/sales/orders/status/dealerReturn/${f}?locale=${e.language}`,r={status_code:n.value.status_code};try{const i=await(await fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.userData.jwtToken},body:JSON.stringify(r)})).json();i.success?alert(i.success):i.error&&alert(i.error.status_code)}catch(a){console.log("error",a)}await D(),e.show_loading(!1)}},se=async()=>{var o;const d=confirm((o=e.language_txt.order)==null?void 0:o.text_confirm_send);if(le(),d){e.show_loading(!0);const u=`${e.baseUrl}api/v2/sales/orders/status/dealerApprove/${f}?locale=${e.language}`,r={status_code:n.value.status_code};try{const a=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.userData.jwtToken},body:JSON.stringify(r)}),i=await a.json();a.ok&&alert(i.success)}catch(a){console.log("error",a)}await D(),e.show_loading(!1)}},le=async()=>{const d=e.exportTable(n.value,"mail"),o=`${e.baseUrl}api/v2/sales/orders/saveExcel?locale=${e.language}`,u=new FormData;u.append("order_id",n.value.id),u.append("order_code",n.value.code),u.append("order-excel",d);try{const a=await(await fetch(o,{method:"POST",headers:{Authorization:"Bearer "+e.userData.jwtToken},body:u})).json()}catch(r){console.log("error",r)}},re=async()=>{var o;if(confirm((o=e.language_txt.order)==null?void 0:o.text_confirm_delete)){e.show_loading(!0);const u=`${e.baseUrl}api/v2/sales/orders/destroyMany`;let r={"selected[]":f};r=e.jsonToFormData(r);try{const a=await fetch(u,{method:"POST",headers:{Authorization:"Bearer "+e.userData.jwtToken},body:r}),i=await a.json();a.ok&&i.success&&(alert(i.success),K.push("/order-list"))}catch(a){console.log("error",a)}e.show_loading(!1)}},V=async d=>{const o=e.temporarily_product||d;console.log("複製出來的或是新增的",o),`${e.baseUrl}${e.language}`;const u=`${e.baseUrl}api/v2/sales/orders/save?locale=${e.language}`,r=[...m.value];if(o){let a,i,h=n.value.material||o.material;if(a=r.reduce((c,_)=>(c+=+_.sqm,c),0),i=r.reduce((c,_)=>(c+=+_.quantity,c),0),o.id){const c=r.findIndex(_=>_.id==o.id);r.splice(c,1),console.log(r)}r.length<1&&(h=o.material),o!=="delete"&&(o.tax=n.value.tax,r.push(o),h=n.value.material||o.material,a=r.reduce((c,_)=>(c+=+_.sqm,c),0),i=r.reduce((c,_)=>(c+=+_.quantity,c),0)),console.log("把複製跟原本加在一起的",r);const O={order_id:f,salesperson_id:n.value.salesperson_id||"",salesperson_first_name:n.value.salesperson_first_name||"",salesperson_last_name:n.value.salesperson_last_name||"",salesperson_email:n.value.salesperson_email||"",salesperson_telephone:n.value.salesperson_telephone||"",salesperson_mobile:n.value.salesperson_mobile||"",shipping_address1:n.value.shipping_address1||"",shipping_address2:n.value.shipping_address2||"",dealer_id:n.value.dealer_id,dealer_name:n.value.dealer_name,customer_first_name:n.value.customer_first_name||"",customer_last_name:n.value.customer_last_name||"",customer_email:n.value.customer_email||"",delivery_method:n.value.delivery_method||"",sqm:a,quantity:i,note:n.value.note,side_mark:n.value.side_mark,material:h,status_code:n.value.status_code,order_products:r},B=e.jsonToFormData(O);try{const c=await fetch(u,{method:"POST",headers:{Authorization:"Bearer "+e.userData.jwtToken},body:B}),_=await c.json();c.ok&&alert(_.success||_.error)}catch(c){console.log("error",c)}await D(),e.temporarily_product=""}},D=async()=>{const d=`${e.baseUrl}api/v2/sales/orders/info?locale=${e.language}&equal_id=${f}`;try{const o=await fetch(d,{headers:{Authorization:"Bearer "+e.userData.jwtToken}}),u=await o.json();o.ok&&(n.value=u.response,m.value=u.response.order_products,v.value=m.value.map(()=>!1))}catch(o){console.log("error",o)}},ne=()=>{e.exportTable(n.value)};return e.show_loading(!0),_e(async()=>{await D(),await V(),e.show_loading(!1)}),(d,o)=>{const u=F,r=F;return p(),g("section",ge,[s("div",fe,[t(n)?(p(),g("div",he,[s("div",ve,[s("div",be,[s("h2",xe,l(t(n).code),1),s("div",ye,l(t(n).material_name||"N/A"),1),s("div",{class:I(["tag",t(e).status_colors(t(n).status_code)])},l(t(n).status_name),3)]),s("div",we,[s("div",null,[s("span",null,l(t(e).language_txt.order.text_product_items)+"：",1),s("span",ke,l(t(m).length),1)]),s("div",null,[s("span",null,l(t(e).language_txt.order.column_total_quantity)+"：",1),s("span",$e,l(t(Y)),1)]),s("div",null,[s("span",null,l(t(e).language_txt.order.text_total_sqm)+"(m2)：",1),s("span",Ce,l(t(Z)),1)])])]),s("div",je,[S(u,{to:"/order-list",class:"btn link"},{default:y(()=>{var a;return[w(l((a=t(e).language_txt.default)==null?void 0:a.text_back),1)]}),_:1}),S(u,{to:`/create_order?code=${t(n).code}&id=${t(f)}`,class:"btn link"},{default:y(()=>[w(l(t(e).language_txt.order.text_information),1)]),_:1},8,["to"]),t(m).length>0&&t($)?(p(),z(u,{key:0,to:`/create_order/order?id=${t(f)}&main=${t(n).material}`,class:"btn link"},{default:y(()=>[w(l(t(e).language_txt.default.text_add)+l(t(e).language_txt.order.tab_products),1)]),_:1},8,["to"])):t($)?(p(),z(u,{key:1,to:`/create_order/order?id=${t(f)}`,class:"btn link"},{default:y(()=>[w(l(t(e).language_txt.default.text_add)+l(t(e).language_txt.order.tab_products),1)]),_:1},8,["to"])):b("",!0),s("button",{class:"btn link",onClick:o[0]||(o[0]=a=>ne())},l(t(e).language_txt.default.text_export),1),S(u,{to:`/order-list/item/note?id=${t(f)}`,class:"btn link"},{default:y(()=>[w(l(t(e).language_txt.order.tab_comments),1)]),_:1},8,["to"])]),s("div",qe,[s("table",Te,[s("thead",null,[s("tr",null,[s("th",null,[N(s("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=a=>E(q)?q.value=a:null),onChange:W},null,544),[[R,t(q)]])]),s("th",null,l(t(e).language_txt.default.column_sort_order),1),s("th",null,l(t(e).language_txt.order.tab_products),1),s("th",null,l(t(e).language_txt.order.text_position),1),s("th",null,l(t(e).language_txt.order.text_width)+"(mm)",1),s("th",null,l(t(e).language_txt.order.text_height)+"(mm)",1),s("th",null,l(t(e).language_txt.order.text_quantity),1),s("th",null,l(t(e).language_txt.order.text_outer_frame),1),s("th",null,l(t(e).language_txt.order.text_color),1),s("th",null,l(t(e).language_txt.order.column_sqm)+"(m2)",1),s("th",De,[N(s("select",{class:"form-select-sm px-3","onUpdate:modelValue":o[2]||(o[2]=a=>E(k)?k.value=a:null)},[s("option",Se,l(U(10)),1),s("option",Oe,l(U(30)),1),s("option",Be,l(U(50)),1)],512),[[pe,t(k)]])])])]),s("tbody",null,[(p(!0),g(L,null,G(t(te),(a,i)=>{var h,O,B,c;return p(),g("tr",{key:"item_"+i},[s("td",null,[N(s("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":_=>t(v)[i]=_},null,8,Ne),[[R,t(v)[i]]])]),s("td",null,l((t(x)-1)*t(k)+i+1),1),s("td",null,l(a.name),1),s("td",null,l((h=a.order_product_options.win_position)==null?void 0:h.value),1),s("td",null,l((O=a.order_product_options.win_width)==null?void 0:O.value),1),s("td",null,l((B=a.order_product_options.win_height)==null?void 0:B.value),1),s("td",null,l(a.quantity),1),s("td",null,l(X(a)),1),s("td",null,l((c=a.order_product_options[`${t(n).material}_color`])==null?void 0:c.value),1),s("td",null,l(a.sqm),1),t($)?(p(),g("td",Ue,[s("button",{type:"button",class:"method-btn btn-s",onClick:_=>M(a)},l(t(e).language_txt.default.text_copy),9,Pe),S(r,{to:`item/product?id=${t(f)}&product=${a.id}&main=${t(n).material}`,class:"method-btn btn-s"},{default:y(()=>[w(l(t(e).language_txt.default.text_edit),1)]),_:2},1032,["to"]),s("button",{type:"button",class:"method-btn btn-s",onClick:_=>A(i)},l(t(e).language_txt.default.text_delete),9,Ae)])):(p(),g("td",Ve,[S(r,{to:`item/product?id=${t(f)}&product=${a.id}&main=${t(n).material}&view=1`,class:"method-btn btn-s"},{default:y(()=>[w(l(t(e).language_txt.default.text_view),1)]),_:2},1032,["to"]),t(T)&&t(e).is_dealer?(p(),z(r,{key:0,to:`item/product?id=${t(f)}&product=${a.id}&main=${t(n).material}`,class:"method-btn btn-s"},{default:y(()=>[w(l(t(e).language_txt.default.text_edit),1)]),_:2},1032,["to"])):b("",!0),t(T)&&t(e).is_dealer?(p(),g("button",{key:1,type:"button",class:"method-btn btn-s",onClick:_=>M(a)},l(t(e).language_txt.default.text_copy),9,ze)):b("",!0),t(T)&&t(e).is_dealer?(p(),g("button",{key:2,type:"button",class:"method-btn btn-s",onClick:_=>A(i)},l(t(e).language_txt.default.text_delete),9,Je)):b("",!0)]))])}),128))])]),N(s("button",{type:"button",class:"btn link mt-2",disabled:!t(Q),onClick:o[3]||(o[3]=a=>A())},l(t(e).language_txt.default.column_batch_delete),9,Me),[[me,t($)]])]),t(m).length>0?(p(),g("div",Fe,[s("button",{disabled:t(x)===1,onClick:o[4]||(o[4]=a=>P(-1))},o[6]||(o[6]=[s("i",{class:"fas fa-caret-left"},null,-1)]),8,Ie),(p(!0),g(L,null,G(t(J),(a,i)=>(p(),g("button",{key:a,class:I(ee(a)),onClick:h=>P(a)},l(a),11,Re))),128)),s("button",{disabled:t(x)===t(J),onClick:o[5]||(o[5]=a=>P(-2))},o[7]||(o[7]=[s("i",{class:"fas fa-caret-right"},null,-1)]),8,Ee)])):b("",!0),s("div",Le,[t($)?(p(),g("button",{key:0,class:"btn cancel",onClick:re},l(t(e).language_txt.default.text_delete)+l(t(e).language_txt.order.text_order),1)):b("",!0),t(T)&&t(e).is_dealer?(p(),g("button",{key:1,class:"btn cancel",onClick:oe},l(t(e).language_txt.order.text_order_status_return_to_draft),1)):b("",!0),t($)&&t(m).length>0?(p(),g("button",{key:2,class:"btn sent_go",onClick:ae},l(t(e).language_txt.order.text_submit_order),1)):b("",!0),t(T)&&t(e).is_dealer?(p(),g("button",{key:3,class:"btn sent_go",onClick:se},l(t(e).language_txt.order.text_order_status_dealer_confirm),1)):b("",!0)])])):b("",!0)])])}}};export{Qe as default};
